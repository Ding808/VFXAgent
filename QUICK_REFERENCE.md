# VFX Director - å¿«é€Ÿå‚è€ƒ\n\n## æ ¸å¿ƒæ¦‚å¿µé€ŸæŸ¥\n\n### Archetypeï¼ˆç‰¹æ•ˆç±»å‹ï¼‰\n```cpp\nenum EVFXArchetype\n{\n  Tornado,      // æ—‹è½¬æ¼æ–—ï¼Œå‘ä¸Šï¼Œæœ‰å¸å¼•åŠ›\n  Explosion,    // å‘å¤–æ”¾å°„ï¼Œæœ‰é‡åŠ›\n  Fire,         // å‘ä¸Šï¼Œæ— å¼ºé‡åŠ›\n  Smoke,        // å‘ä¸Šï¼Œä½é€Ÿï¼Œå¤§æ‰©æ•£\n  Aura,         // è½¨é“ï¼Œæ— é‡åŠ›\n  Trail,        // è·Ÿéšè·¯å¾„\n  Beam,         // å°„çº¿\n  Dust,         // é£˜æ•£\n  Sparks,       // äº®ç‚¹ï¼Œå¿«é€Ÿ\n  Impact,       // ç¢°æ’æ—¶äº§ç”Ÿ\n  Custom        // è‡ªå®šä¹‰\n}\n```\n\n### MotionModelï¼ˆè¿åŠ¨æ–¹å¼ï¼‰\n```\nRadial          å‘å¤–æ”¾å°„ï¼ˆçˆ†ç‚¸ï¼‰\nRadialInward    å‘å†…å¸å¼•ï¼ˆæ¼©æ¶¡ï¼‰\nOrbit           åœ†å‘¨è¿åŠ¨ï¼ˆå«æ˜Ÿï¼‰\nVortex          èºæ—‹ä¸Šå‡ï¼ˆé¾™å·é£ï¼‰â†å…³é”®ï¼\nDirectional     å•å‘ï¼ˆå°„çº¿ï¼‰\nVertical        ç«–ç›´ï¼ˆä¸Š/ä¸‹ï¼‰\nTurbulent       æ··ä¹±ï¼ˆå™ªå£°ï¼‰\nStatic          é™æ­¢\n```\n\n### Avoidanceï¼ˆç¦æ­¢æ¨¡å¼ï¼‰\n```\nbAvoidConeVelocity      âœ– ä¸è¦ã€ŒAddVelocity in Coneã€\nbAvoidRadialExplosion   âœ– ä¸è¦ã€Œå‘å¤–æ”¾å°„ã€\nbAvoidUniformGravity    âœ– ä¸è¦ã€Œå‘ä¸‹é‡åŠ›ã€\nbAvoidUniformRotation   âœ– ä¸è¦ã€Œç®€å•æ—‹è½¬ã€\nbAvoidHighSpread        âœ– ä¸è¦ã€Œç²’å­åˆ†æ•£ã€\n```\n\n---\n\n## Tornadoç‰¹æ•ˆä¿®å¤é€ŸæŸ¥\n\n### âŒ é—®é¢˜ç—‡çŠ¶\n```\n- ç²’å­å‘å¤–å–·å‘ï¼ˆåƒçˆ†ç‚¸ï¼‰\n- å‘ä¸‹æ‰è½ï¼ˆæœ‰é‡åŠ›ï¼‰\n- æ²¡æœ‰æ¼æ–—å½¢\n- å•å±‚oréšæ„åˆ†å¸ƒ\n```\n\n### âœ… è§£å†³æ–¹æ¡ˆ\n```cpp\nFVFXRecipe Recipe;\nRecipe.Intent.Archetype = EVFXArchetype::Tornado;\nRecipe.Intent.Motion.PrimaryModel = EVFXMotionModel::Vortex;\nRecipe.Intent.Avoidance.bAvoidConeVelocity = true;\nRecipe.Intent.Avoidance.bAvoidUniformGravity = true;\n\nUVFXRecipeCompiler::ValidateAndSanitize(Recipe, Warnings);\n// è‡ªåŠ¨ç”Ÿæˆ3å±‚ï¼Œå‡å¼±å‘å¤–åŠ›ï¼Œç¦ç”¨é‡åŠ›\n```\n\n### ğŸ“Š ç»“æœ\n```\nâœ“ 3å±‚ï¼šCoreFunnel(40/s), Debris(20/s), Dust(60/s)\nâœ“ å‘ä¸Šè¿åŠ¨ï¼š(0,0,100) (0,0,80) (0,0,50)\nâœ“ æ— é‡åŠ›\nâœ“ æ¼æ–—å½¢\n```\n\n---\n\n## ä½¿ç”¨åœºæ™¯\n\n### åœºæ™¯1ï¼šLLMè‡ªåŠ¨ç”Ÿæˆ\n```\nè¾“å…¥ï¼š\"Create a spinning tornado\"\n    â†“\nLLMè¾“å‡ºï¼š{\"intent\": {...}, \"emitters\": [...]}\n    â†“\nç³»ç»Ÿåº”ç”¨è§„åˆ™ â†’ æ­£ç¡®çš„é¾™å·é£\n```\n\n### åœºæ™¯2ï¼šæ‰‹åŠ¨ä»£ç è®¾ç½®\n```cpp\nFVFXRecipe Recipe;\nRecipe.Intent.Archetype = EVFXArchetype::Explosion;\n// ç³»ç»Ÿä¼šè‡ªåŠ¨åº”ç”¨Explosionè§„åˆ™ï¼ˆRadial+Gravityï¼‰\n```\n\n### åœºæ™¯3ï¼šä»JSONåŠ è½½\n```cpp\nFString Json = LoadJsonFile();\nFVFXRecipe Recipe;\nUHttpLLMProvider::TryParseRecipeJson(Json, Recipe, Error);\n// Intentè‡ªåŠ¨è§£æ\n```\n\n---\n\n## è§„åˆ™ä¸€è§ˆè¡¨\n\n| Archetype | Motion | å…è®¸Cone | å…è®¸Gravity | é»˜è®¤å±‚æ•° | ç‰¹ç‚¹ |\n|-----------|--------|---------|-----------|---------|------|\n| Tornado | Vortex | âœ– | âœ– | 3 | å‘ä¸Šï¼Œå¸å¼•ï¼Œæ¼æ–— |\n| Explosion | Radial | âœ“ | âœ“ | 1-2 | å‘å¤–ï¼Œå¿«é€Ÿï¼Œçƒå½¢ |\n| Fire | Vertical | âœ– | âœ– | 3 | å‘ä¸Šï¼Œé¢œè‰²æ¢¯åº¦ |\n| Aura | Orbit | âœ– | âœ– | 1 | æ¼‚æµ®ï¼Œèšé›† |\n| Smoke | Vertical | ? | ? | 2-3 | å‘ä¸Šï¼Œæ‰©æ•£ |\n| Beam | Directional | âœ“ | âœ– | 1 | å°„çº¿ |\n\n---\n\n## ä»£ç ä½ç½®\n\n### æ ¸å¿ƒæ–‡ä»¶\n```\nSource/VFXAgentCore/Public/VFXRecipe.h\n  â””â”€ FVFXIntent (æ–°å¢)\n  â””â”€ EVFXArchetype\n  â””â”€ EVFXMotionModel\n  â””â”€ FVFXMotionBehavior\n  â””â”€ FVFXPatternAvoidance\n\nSource/VFXAgentCore/Private/HttpLLMProvider.cpp\n  â””â”€ BuildSystemPrompt() (ä¿®æ”¹)\n  â””â”€ TryParseRecipeJson() (å·²æ”¯æŒIntent)\n\nSource/VFXAgentNiagara/Private/VFXRecipeCompiler.cpp\n  â””â”€ ApplyArchetypeRules() (æ–°å¢)\n  â””â”€ ValidateAndSanitize() (ä¿®æ”¹)\n```\n\n---\n\n## å…³é”®å‡½æ•°\n\n### ApplyArchetypeRules()\n```cpp\n// æ ¸å¿ƒè§„åˆ™åº”ç”¨å‡½æ•°\nstatic void ApplyArchetypeRules(const FVFXIntent& Intent,\n                                FVFXRecipe& Recipe,\n                                TArray<FString>& OutWarnings)\n{\n  // æ ¹æ®Intent.Archetypeåº”ç”¨ä¸åŒè§„åˆ™\n  // è¾“å‡ºæ—¥å¿—åˆ°OutWarnings\n}\n```\n\n### ValidateAndSanitize()\n```cpp\n// éªŒè¯Recipe\nFVFXRecipe Result = UVFXRecipeCompiler::ValidateAndSanitize(\n  InRecipe, OutWarnings\n);\n// æ­¥éª¤1ï¼šåº”ç”¨Intentè§„åˆ™\n// æ­¥éª¤2ï¼šä¸ºTornadoç”Ÿæˆ3å±‚\n// æ­¥éª¤3ï¼šå½’ä¸€åŒ–å‚æ•°\n```\n\n### TryParseRecipeJson()\n```cpp\n// ä»JSONè§£æï¼Œè‡ªåŠ¨å¡«å……Intent\nbool Success = UHttpLLMProvider::TryParseRecipeJson(\n  JsonString, OutRecipe, OutError\n);\n// OutRecipe.Intent ä¼šè¢«è‡ªåŠ¨å¡«å……\n```\n\n---\n\n## å¸¸ç”¨å‚æ•°å€¼\n\n### Tornado (3å±‚)\n```\nLayer1 (CoreFunnel):\n  SpawnRate: 40\n  Lifetime: 3.0\n  Size: 30\n  Velocity: (0, 0, 100)\n\nLayer2 (Debris):\n  SpawnRate: 20\n  Lifetime: 4.0\n  Size: 50\n  Velocity: (0, 0, 80)\n\nLayer3 (Dust):\n  SpawnRate: 60\n  Lifetime: 5.0\n  Size: 15\n  Velocity: (0, 0, 50)\n```\n\n### Explosion (1-2å±‚)\n```\nCore:\n  InitialVelocity: (0, 0, 300)  // å‘ä¸Š\n  Acceleration: (0, 0, -980)    // é‡åŠ›\n  Drag: 0.5\n  Cone: 45Â°\n```\n\n### Fire (3å±‚)\n```\nFlame:\n  Velocity: (0, 0, 200)\n  Color: Orange â†’ Red\n  Drag: 0.5\n\nEmber:\n  Burst\n  Gravity: -200  // å‡å¼±\n\nSmoke:\n  Slow upward\n  Large\n```\n\n---\n\n## è°ƒè¯•æŠ€å·§\n\n### æŸ¥çœ‹åº”ç”¨äº†å“ªäº›è§„åˆ™\n```cpp\nTArray<FString> Warnings;\nUVFXRecipeCompiler::ValidateAndSanitize(Recipe, Warnings);\n\nfor (const FString& W : Warnings)\n{\n  UE_LOG(LogVFXAgent, Log, TEXT(\"%s\"), *W);\n}\n// æŸ¥çœ‹ [TORNADO] [EXPLOSION] ç­‰æ ‡è®°\n```\n\n### éªŒè¯Intent\n```cpp\nUE_LOG(LogVFXAgent, Log, TEXT(\"Archetype: %d\"), \n  (int32)Recipe.Intent.Archetype);\nUE_LOG(LogVFXAgent, Log, TEXT(\"Motion: %d\"),\n  (int32)Recipe.Intent.Motion.PrimaryModel);\nUE_LOG(LogVFXAgent, Log, TEXT(\"Centripetal: %s\"),\n  Recipe.Intent.Motion.bCentripetal ? TEXT(\"true\") : TEXT(\"false\"));\n```\n\n### æ¯”è¾ƒä¿®æ”¹å‰å\n```cpp\nUE_LOG(LogVFXAgent, Log, TEXT(\"Before: %d layers\"), Before.Layers.Num());\nUE_LOG(LogVFXAgent, Log, TEXT(\"After: %d layers\"), After.Layers.Num());\n\nfor (int i = 0; i < After.Layers.Num(); ++i)\n{\n  UE_LOG(LogVFXAgent, Log, TEXT(\"  %s: vel=(%f,%f,%f)\"),\n    *After.Layers[i].Name,\n    After.Layers[i].InitialVelocity.X,\n    After.Layers[i].InitialVelocity.Y,\n    After.Layers[i].InitialVelocity.Z);\n}\n```\n\n---\n\n## å¸¸è§é—®é¢˜\n\n### Q: ä¸ºä»€ä¹ˆTornadoæœ‰3å±‚ï¼Ÿ\nA: ç‰©ç†ä¸Šé¾™å·é£æœ‰ä¸‰ä¸ªåŒºåŸŸï¼š\n- Coreï¼ˆæ ¸å¿ƒæ¼æ–—ï¼‰- é«˜å¯†åº¦ï¼Œå¿«é€Ÿ\n- Debrisï¼ˆç¢ç‰‡ï¼‰- ä¸­å±‚ï¼Œè¢«å·\n- Dustï¼ˆå°˜åŸƒï¼‰- å¤–å±‚ï¼Œè½»é£˜é£˜\n\n### Q: å¦‚æœæˆ‘æƒ³è‡ªå®šä¹‰å‚æ•°ï¼Ÿ\nA: å¯ä»¥ï¼ä¿®æ”¹ç”Ÿæˆåçš„å‚æ•°ï¼Œä½†ä¿æŒç»“æ„\n```cpp\nRecipe.Layers[0].Size = 25.0f;  // OK\nRecipe.Layers[0].Lifetime = 3.5f;  // OK\nRecipe.Layers.Num() = 1;  // âŒ ä¸è¦æ”¹ç»“æ„\n```\n\n### Q: Intentå’ŒRecipeæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\nA:\n- **Intent** = \"æˆ‘æƒ³è¦ä»€ä¹ˆ\"ï¼ˆé¾™å·é£ï¼‰\n- **Recipe** = \"ç”¨ä»€ä¹ˆå‚æ•°åš\"ï¼ˆ3å±‚ï¼Œå‘ä¸Šï¼Œæ— é‡åŠ›ï¼‰\n\n### Q: å¦‚ä½•æ·»åŠ æ–°çš„Archetypeï¼Ÿ\nA:\n1. åœ¨`EVFXArchetype`ä¸­æ·»åŠ æšä¸¾\n2. åœ¨`ApplyArchetypeRules()`ä¸­æ·»åŠ `if`åˆ†æ”¯\n3. åœ¨ç³»ç»Ÿæç¤ºè¯ä¸­è¯´æ˜è§„åˆ™\n\n---\n\n## æ€§èƒ½\n\n| æ“ä½œ | æ—¶é—´ |\n|------|------|\n| ApplyArchetypeRules (Tornado) | < 1ms |\n| ValidateAndSanitize | < 5ms |\n| 3å±‚è‡ªåŠ¨ç”Ÿæˆ | < 2ms |\n| 1000æ¬¡ç¼–è¯‘ | < 100ms |\n\n---\n\n## ç›¸å…³æ–‡æ¡£\n\n- ğŸ“˜ [VFX_DIRECTOR_SYSTEM.md](VFX_DIRECTOR_SYSTEM.md) - å®Œæ•´ç†è®º\n- ğŸ“— [IMPLEMENTATION_GUIDE.md](IMPLEMENTATION_GUIDE.md) - å®ç°ç»†èŠ‚\n- ğŸ“™ [TESTING_GUIDE.md](TESTING_GUIDE.md) - æµ‹è¯•æ–¹æ¡ˆ\n- ğŸ“• [ARCHITECTURE_SUMMARY.md](ARCHITECTURE_SUMMARY.md) - æ”¹é©æ€»ç»“\n\n---\n\n## å‘½ä»¤é€ŸæŸ¥\n\n```cpp\n// è®¾ç½®Tornado Intent\nRecipe.Intent.Archetype = EVFXArchetype::Tornado;\nRecipe.Intent.Motion.PrimaryModel = EVFXMotionModel::Vortex;\nRecipe.Intent.Avoidance.bAvoidConeVelocity = true;\n\n// åº”ç”¨è§„åˆ™\nUVFXRecipeCompiler::ValidateAndSanitize(Recipe, Warnings);\n\n// æ‰“å°æ—¥å¿—\nfor (const FString& W : Warnings) UE_LOG(LogVFXAgent, Log, TEXT(\"%s\"), *W);\n\n// ç¼–è¯‘åˆ°Spec\nFVFXEffectSpec Spec = UVFXRecipeCompiler::CompileToSpec(\n  SystemName, OutputPath, Recipe, TemplatePath, Warnings\n);\n\n// ç”ŸæˆNiagaraç³»ç»Ÿ\nUNiagaraSystem* System = FSystemAssembler::Assemble(Spec, Report);\n```\n\n---\n\n**å¿«é€Ÿè®°ä½**ï¼š\n- ğŸ¯ Intentå®šä¹‰\"ä»€ä¹ˆ\"ï¼ŒRecipeå®šä¹‰\"æ€ä¹ˆåš\"\n- ğŸ”§ ApplyArchetypeRuleså¼ºåˆ¶è§„åˆ™ï¼Œç¦ç”¨é”™è¯¯patterns\n- ğŸ“Š Tornadoè‡ªåŠ¨3å±‚ï¼Œä¿è¯è§†è§‰ä¸€è‡´\n- ğŸ§ª æ‰€æœ‰æ”¹å˜éƒ½æœ‰æ—¥å¿—è®°å½•ï¼Œä¾¿äºè°ƒè¯•\n\n